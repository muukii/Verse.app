# YouTubeSubtitle - プロダクト仕様書

## 概要

YouTubeSubtitleは、YouTube動画の字幕を表示しながら動画を視聴できるmacOS/iOSアプリケーションです。字幕のタップジャンプ、自動スクロール、視聴履歴管理などの機能を備えています。

### ターゲットユーザー
- 語学学習者（英語学習など）
- 字幕を見ながら正確に内容を理解したいユーザー
- 特定の部分を繰り返し視聴したいユーザー

## 主要機能

### 1. 動画再生機能

#### 1.1 YouTube動画の再生
- YouTube URLから動画を再生
- 再生/一時停止、シーク操作対応
- 対応URL形式:
  - `https://www.youtube.com/watch?v=VIDEO_ID`
  - `https://youtu.be/VIDEO_ID`

#### 1.2 再生コントロール
- **再生時間表示**: 現在時間 / 総時間
- **シークバー**: ドラッグで任意の位置にジャンプ
- **再生速度調整**: 0.25x - 2.0x（0.25刻み）
- **リピート機能**:
  - 開始時間・終了時間を設定
  - 指定区間の繰り返し再生
- **ステップモード**:
  - 字幕キューごとに再生を停止するモード（語学学習向け）
  - 再生ボタンの長押しコンテキストメニューで切り替え（Normal / Step Mode）
  - 動作: 各字幕の`endTime`で自動停止 → 再生ボタンで次のキューへ
  - 視覚的表示: ステップモード時はアウトラインアイコン（`play`/`pause`）、通常時は塗りつぶしアイコン（`play.fill`/`pause.fill`）
  - 設定は`@AppStorage`で永続化

### 2. 字幕機能

#### 2.1 字幕の取得と表示
- **対応言語**: 英語字幕
- **表示形式**: タイムスタンプ + 字幕テキスト
- **自動取得**: 動画を開くと自動的に字幕を取得

#### 2.2 字幕ナビゲーション
- **タップでジャンプ**: 字幕をタップすると該当時間に移動
- **現在字幕のハイライト**: 再生中の字幕を青色で強調表示
- **自動スクロール（トラッキング）**:
  - デフォルトでON
  - 再生位置に合わせて字幕が自動的にスクロール

#### 2.3 字幕トラッキング制御
- **トグルボタン**: ヘッダーの"eye" / "eye.slash"アイコン
- **自動OFF機能**: ユーザーが手動でスクロールすると自動的にOFFになる
- **手動ON**: ボタンをタップして再度有効化

### 3. 視聴履歴機能

#### 3.1 履歴管理
- **自動保存**: 動画を開くと自動的に履歴に追加
- **重複防止**: 同じ動画は最新のもののみ保持
- **最大件数**: 50件（古いものから自動削除）
- **データ保存**: デバイス内にローカル保存

#### 3.2 履歴表示
- **リスト形式**: サムネイル + タイトル + タイムスタンプ
- **サムネイル**: 動画のサムネイル画像を表示（120x68px）
- **タイトル**: 動画タイトルを自動取得
- **相対時間表示**: "2 hours ago", "1 day ago"など

#### 3.3 履歴操作
- **タップで再生**: 履歴アイテムをタップして動画を開く
- **スワイプ削除**: 個別アイテムの削除
- **全削除**: ツールバーの"Clear History"ボタン

### 4. 外部連携機能

#### 4.1 Shortcuts対応
- **Shortcutsアプリ対応**: "Open YouTube Video"アクションが利用可能
- **Siri対応**: 音声コマンドでの起動可能
- **外部からのURL受信**: Shortcutsや他のアプリからYouTube URLを受け取って動画を開く

## 画面構成

### ホーム画面 (HomeView)
- **URL入力欄**: YouTube URLを入力
- **視聴履歴リスト**: 
  - サムネイル画像
  - 動画タイトル
  - 視聴日時（相対表示）
- **操作**:
  - URL入力後Enterで動画を開く
  - 履歴アイテムタップで動画を開く
  - スワイプで個別削除
  - ツールバーから全削除

### プレイヤー画面 (PlayerView)
- **左側: 動画プレイヤー**
  - YouTubeプレイヤー
  - 再生コントロール（再生/停止、シークバー）
  - 再生速度調整
  - リピート設定
- **右側: 字幕パネル**
  - ヘッダー（字幕数、トラッキングボタン）
  - 字幕リスト（スクロール可能）
  - 現在の字幕をハイライト表示

## UI/UX仕様

### カラー
- **現在字幕**: 青色背景で強調
- **通常字幕**: 薄いグレー背景
- **トラッキングON**: 青色アイコン
- **トラッキングOFF**: グレーアイコン

### レイアウト
- **HomeView**: 縦方向レイアウト（上部入力、下部リスト）
- **PlayerView**: 横方向2カラムレイアウト
- **字幕パネル幅**: 固定幅または可変

## 今後の拡張案

- [ ] 作者名の表示（YouTubeKitでは未対応）
- [ ] 字幕言語の選択機能
- [ ] プレイリスト対応
- [ ] オフライン字幕保存
- [ ] 字幕検索機能
- [ ] ダークモード対応強化
